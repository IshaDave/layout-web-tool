{% import '_macros.html' as macros %}
{% extends "base.html" %}

{# BEGIN: Quality Managment form macro #}
{% macro form_content(data=None, show_add_btn=False, show_rm_btn=True) %}
{# Define default dict/list here (never in signature) so we don't have to check
for every input #}
{% with data = data if data else {} %}
  <div class="form-group">
    <label>This is how I do quality management</label>
    <input type="text" class="form-control" value="{{ data.get('cmd', "") }}" name="cmd[]">
  </div>
  <h3 class="mt-4 mb-3">How do you know everything's fine?</h3>
  <div class="form-group row">
    <div class="col-3 col-form-label">Return value</div>
    <div class="input-group col-9">
      <select class="custom-select input-group-select" name="retval_operator[]">
        <option value="eq" {{"selected" if data.get("retval_operator", "") == "eq"}}>is equal to</option>
        <option value="ne" {{"selected" if data.get("retval_operator", "") == "ne"}}>is not equal to</option>
        <option value="gt" {{"selected" if data.get("retval_operator", "") == "gt"}}>is greater than</option>
        <option value="lt" {{"selected" if data.get("retval_operator", "") == "lt"}}>is lesser than</option>
        <option value="ge" {{"selected" if data.get("retval_operator", "") == "ge"}}>is greater-equal than</option>
        <option value="le" {{"selected" if data.get("retval_operator", "") == "le"}}>is lesser-equal than</option>
      </select>
      <input type="number" class="form-control" min="0" name="retval_value[]" value="{{ data.get('retval_value', "") }}">
    </div>
  </div>
  <div class="form-group row">
    <div class="col-3 col-form-label">Standard output</div>
    <div class="input-group col-9">
      <select class="custom-select input-group-select" name="stdout_operator[]">
        <option value="is" {{"selected" if data.get("stdout_operator", "") == "eq"}}>is</option>
        <option value="is-not" {{"selected" if data.get("stdout_operator", "") == "ne"}}>is not</option>
        <option value="contains" {{"selected" if data.get("stdout_operator", "") == "contains"}}>contains</option>
        <option value="contains-not" {{"selected" if data.get("stdout_operator", "") == "contains_not"}}>does not contain</option>
        <option value="empty" {{"selected" if data.get("stdout_operator", "") == "empty"}}>is empty</option>
      </select>
      <input type="text" class="form-control" name="stdout_value[]" value="{{ data.get('stdout_value', "") }}">
    </div>
  </div>
  <div class="form-group row">
    <div class="col-3 col-form-label">Standard error</div>
    <div class="input-group col-9">
      <select class="custom-select input-group-select" name="stderr_operator[]">
        <option value="is" {{"selected" if data.get("stderr_operator", "") == "eq"}}>is</option>
        <option value="is-not" {{"selected" if data.get("stderr_operator", "") == "ne"}}>is not</option>
        <option value="contains" {{"selected" if data.get("stderr_operator", "") == "contains"}}>contains</option>
        <option value="contains-not" {{"selected" if data.get("stderr_operator", "") == "contains_not"}}>does not contain</option>
        <option value="empty" {{"selected" if data.get("stderr_operator", "") == "empty"}}>is empty</option>
      </select>
      <input type="text" class="form-control" name="stderr_value[]" value="{{ data.get('stderr_value', "") }}">
    </div>
  </div>
  <div class="form-group">
    <button type="button" class="copy-btn btn btn-outline-warning {{'d-none' if not show_add_btn}}">Add and continue on this page</button>
    <button type="button" class="copy-btn btn btn-outline-primary {{'d-none' if not show_add_btn}}" data-submit="qa-form">Add and continue on next page</button>
    <button type="button" data-toremove=".opt-form" class="rm-btn btn btn-outline-danger {{'d-none' if not show_rm_btn}}">Remove</button>
  </div>
{% endwith %}
{%- endmacro %}
{# END: Quality Managment form macro #}



{# BEGIN: Rendered content #}
{% block content %}
  {{ macros.progress_bar(value=40) }}
  <hr>
  <h1>How do you assure your software's quality?
  </h1>
  {{ lipsum(n=1, html=True, min=50, max=51) }}


  {# BEGIN: Option Grid #}
  <h2 class="mt-5">Which tools do you use for quality assurance?</h2>
  {% call(data) macros.option_grid(options=options) %}
    {{ form_content(data={ "cmd": data.get("cmd") }, show_add_btn=True, show_rm_btn=False) }}
  {% endcall %}
  {# END: Option Grid #}

  {# BEGIN: Postable Form Content #}
  {% call(data=None) macros.form_container(form_id="qa-form", form_action=url_for('quality_management'), user_data=user_data) %}
    {{ form_content(data=data) }} {# data passed back from macro #}
  {% endcall %}
  {# END: Postable Form Content #}

  {# BEGIN: Navigation Footer (Previous/Next) #}
  <hr>
  <div class="row no-gutters justify-content-between">
    <div class="col-3">
      <a class="btn btn-primary btn-block" href="{{ url_for('building')}} ">Previous</a>
    </div>
    <div class="col-3">
      <input type="submit" form="qa-form" class="btn btn-primary btn-block" value="Next">
    </div>
  </div>
  {# END: Navigation Footer (Previous/Next) #}

{% endblock %}
{# END: Rendered content #}
