{% import '_macros.html' as macros %}
{% extends "base.html" %}

{# BEGIN: Rendered content #}
{% block content %}
  {{ macros.progress_bar(value=99) }}
  <hr>
  <h1>Congrats, you are now the proud owner of a custom in-toto layout!</h1>
  <p>
  But not so fast you still have to do a couple of things before your clients can verify your software with in-toto!
  </p>

  {# BEGIN: Download layout #}
  <h2 class="mt-5 mb-2">1. Download the Layout</h2>
  <div class="row no-gutters">
    <a href="{{url_for('download_layout')}}" target="_blank" class="col-12 btn btn-outline-primary">Download Layout</a>
  </div>
  {# END: Download layout #}

  {# BEGIN: Create owner key snippet #}
  <h2 class="mt-5 mb-2">2. Create a project owner key pair (if you don't already have one)</h2>
  <small>You can use this command to create an RSA keypair:</small>
  <div>
<pre class="code">
in-toto-keygen &ltFILENAME&gt
</pre>
  </div>
  {# END: Create owner key snippet #}

  {# BEGIN: Sign layout snippet #}
  <h2 class="mt-5 mb-2">3. Sign your layout with your project owner key</h2>
  <div>
<pre class="code">
in-toto-sign --key project-owner root.layout
</pre>
  </div>
  {# END: Sign layout snippet #}

  {# BEGIN: Per functionary in-toto-run snippets #}
  <h2 class="mt-5 mb-2">4. Instruct your functionaries to use in-toto commands</h2>
  {% for functionary in functionaries %}
    <h3 class="mt-3 mb-2">{{functionary}}</h3>
      <div>{# "-" strips newlines before/after blocks, which would be
  displayed in pre elems #}
<pre class="code">
{% for item in items %}
{%- if item.type == "step" and functionary in auths.get(item.name).get("authorized_functionaries", []) -%}
in-toto-run --key {{functionary}} --materials . --products . --step-name {{item.name}} -- {{item.cmd}}
{% endif %}
{%- endfor -%}
</pre>
      </div>
  {% endfor %}
  {# END: Per functionary in-toto-run snippets #}

  {# BEGIN: Begin next step instructions #}
  <h2 class="mt-5 mb-2">5. Ship out in-toto metadata along with your software</h2>
  {# END: Begin next step instructions #}

  {# BEGIN: Navigation Footer (Previous/Next) #}
  <hr>
  <div class="row no-gutters justify-content-between">
    <div class="col-3">
      <a class="btn btn-primary btn-block" href="{{ url_for('chaining')}} ">Previous</a>
    </div>
    <div class="col-3">
      <a class="btn btn-primary btn-block" href="{{ url_for('guarantees')}} ">Next</a>
    </div>
  </div>
  {# END: Navigation Footer (Previous/Next) #}
{% endblock %}
{# END: Rendered content #}
